{% extends "base.html" %}

{% block title %}Game Results - Art Collector{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    {% if is_winner %}
    <div class="text-center mb-8 animate-pulse">
        <h1 class="text-6xl font-bold text-primary mb-4">üèÜ You Won! üèÜ</h1>
        <p class="text-2xl">Congratulations on building the best collection!</p>
    </div>
    {% else %}
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">Game Over</h1>
        <p class="text-xl opacity-70">Final Standings</p>
    </div>
    {% endif %}

    <!-- Final Scores -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">Final Scores</h2>
            <div class="space-y-3">
                {% for (rank, player_score) in final_scores.iter().enumerate() %}
                <div class="flex items-center gap-4 p-4 rounded-lg
                    {% if player_score.is_winner %}bg-primary text-primary-content{% else %}bg-base-200{% endif %}
                ">
                    <div class="text-3xl font-bold w-12 text-center">
                        {% if rank == 0 %}
                            ü•á
                        {% else if rank == 1 %}
                            ü•à
                        {% else if rank == 2 %}
                            ü•â
                        {% else %}
                            {{ rank + 1 }}
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-lg">{{ player_score.name }}</div>
                        <div class="text-sm opacity-70">
                            {{ player_score.collection_count }} pieces collected
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold">{{ player_score.score }}</div>
                        <div class="text-xs opacity-70">points</div>
                    </div>
                    {% if player_score.is_winner %}
                    <div class="badge badge-lg">Winner</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Scoring Breakdown Info -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h3 class="card-title">How Scoring Works</h3>
            <div class="space-y-3 text-sm">
                <div class="flex items-start gap-3">
                    <div class="badge badge-primary">1</div>
                    <div>
                        <p class="font-semibold">Base Score</p>
                        <p class="opacity-70">Sum of all star values in your collection</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="badge badge-secondary">2</div>
                    <div>
                        <p class="font-semibold">Artist Bonus</p>
                        <p class="opacity-70">
                            For each artist, multiply: (sum of stars) √ó (number of pieces)
                        </p>
                        <p class="text-xs opacity-50 mt-1">
                            Example: 3 Van Gogh pieces (3‚òÖ + 2‚òÖ + 2‚òÖ) = 7 √ó 3 = 21 points
                        </p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="badge badge-accent">3</div>
                    <div>
                        <p class="font-semibold">Movement Bonus</p>
                        <p class="opacity-70">
                            For each movement, multiply: (sum of stars) √ó (number of pieces)
                        </p>
                        <p class="text-xs opacity-50 mt-1">
                            Example: 2 Impressionist pieces (3‚òÖ + 2‚òÖ) = 5 √ó 2 = 10 points
                        </p>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="flex items-start gap-3">
                    <div class="text-2xl">üéØ</div>
                    <div>
                        <p class="font-semibold">Final Score</p>
                        <p class="opacity-70">MAX(Artist Bonus, Movement Bonus)</p>
                        <p class="text-xs opacity-50 mt-1">You score whichever bonus is higher!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="flex justify-center gap-4">
        {% if let Some(next_id) = next_game_id %}
        <a href="/game/{{ next_id }}/play-again?player_id={{ player_id }}&old_game_id={{ game_id }}" class="btn btn-primary btn-lg">
            üéÆ Play Again
        </a>
        {% else %}
        <form action="/create" method="post">
            <button type="submit" class="btn btn-primary btn-lg">
                üéÆ Play Again
            </button>
        </form>
        {% endif %}
        <a href="/" class="btn btn-ghost btn-lg">
            üè† Home
        </a>
    </div>
</div>
{% endblock %}
